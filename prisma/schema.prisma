generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  admin
  instructor
  student
}

model User {
  id       Int     @id @default(autoincrement())
  name     String
  email    String  @unique
  password String
  role     Role
  avatar   String?
  
  coursesCreated Course[] @relation("InstructorCourses")
  coursesEnrolled Course[] @relation("StudentCourses", references: [id])
  lectures       Lecture[] @relation("InstructorLectures")
  assignments    Assignment[] @relation("InstructorAssignments")
  submissions    Submission[] @relation("StudentSubmissions")
  files          File[]     @relation("UserFiles", references: [id])
}

model Course {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  createdBy   User     @relation("InstructorCourses", fields: [createdById], references: [id])
  createdById Int
  students    User[]   @relation("StudentCourses")

  lectures    Lecture[]
  assignments Assignment[]
}

model Lecture {
  id          Int      @id @default(autoincrement())
  title       String
  content     String
  course      Course   @relation(fields: [courseId], references: [id])
  courseId    Int
  videoUrl    String?
  attachments File[]   @relation("LectureAttachments")
}

model Assignment {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  course      Course   @relation(fields: [courseId], references: [id])
  courseId    Int
  dueDate     DateTime

  submissions Submission[]
}

model Submission {
  id          Int      @id @default(autoincrement())
  assignment  Assignment @relation(fields: [assignmentId], references: [id])
  assignmentId Int
  student     User      @relation("StudentSubmissions", fields: [studentId], references: [id])
  studentId   Int
  file        File?     @relation(fields: [fileId], references: [id])
  fileId      Int?
  submittedAt DateTime
  grade       Float?
}

model File {
  id         Int      @id @default(autoincrement())
  filename   String
  url        String
  uploadedBy User     @relation("UserFiles", fields: [uploadedById], references: [id])
  uploadedById Int
  
  lectures   Lecture[] @relation("LectureAttachments")
  submissions Submission[]
}
